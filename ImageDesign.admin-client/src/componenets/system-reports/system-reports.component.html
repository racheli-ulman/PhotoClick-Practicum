<div class="reports-container">
    <div class="reports-header">
        <h2>דוחות מערכת</h2>
        <div class="header-actions">
            <button mat-raised-button color="primary" (click)="refreshAllReports()">
                <mat-icon>refresh</mat-icon>
                רענן דוחות
            </button>
            <button mat-raised-button color="accent" (click)="exportReports()">
                <mat-icon>download</mat-icon>
                ייצא דוחות
            </button>
        </div>
    </div>

    <!-- דוח סיכום כללי -->
    <mat-card class="summary-card">
        <mat-card-header>
            <mat-card-title>סיכום כללי של המערכת</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="summary-grid">
                <div class="summary-item">
                    <mat-icon class="summary-icon users">people</mat-icon>
                    <div class="summary-details">
                        <div class="summary-value">{{ systemSummary.totalUsers }}</div>
                        <div class="summary-label">סה"כ משתמשים</div>
                    </div>
                </div>

                <div class="summary-item">
                    <mat-icon class="summary-icon albums">photo_library</mat-icon>
                    <div class="summary-details">
                        <div class="summary-value">{{ systemSummary.totalAlbums }}</div>
                        <div class="summary-label">סה"כ אלבומים</div>
                    </div>
                </div>

                <div class="summary-item">
                    <mat-icon class="summary-icon photos">insert_photo</mat-icon>
                    <div class="summary-details">
                        <div class="summary-value">{{ systemSummary.totalPhotos }}</div>
                        <div class="summary-label">סה"כ תמונות</div>
                    </div>
                </div>

                <div class="summary-item">
                    <mat-icon class="summary-icon storage">storage</mat-icon>
                    <div class="summary-details">
                        <div class="summary-value">{{ formatFileSize(systemSummary.totalStorage) }}</div>
                        <div class="summary-label">נפח אחסון</div>
                    </div>
                </div>

                <div class="summary-item">
                    <mat-icon class="summary-icon tags">label</mat-icon>
                    <div class="summary-details">
                        <div class="summary-value">{{ systemSummary.totalTags }}</div>
                        <div class="summary-label">סה"כ תגיות</div>
                    </div>
                </div>

                <div class="summary-item">
                    <mat-icon class="summary-icon deleted">delete</mat-icon>
                    <div class="summary-details">
                        <div class="summary-value">{{ systemSummary.deletedPhotos }}</div>
                        <div class="summary-label">תמונות מחוקות</div>
                    </div>
                </div>
            </div>
        </mat-card-content>
    </mat-card>

    <!-- דוח פעילות משתמשים -->
    <mat-card class="report-card">
        <mat-card-header>
            <mat-card-title>דוח פעילות משתמשים</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="table-container">
                <table mat-table [dataSource]="userActivityReport" class="report-table" matSort>
                    
                    <ng-container matColumnDef="userName">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>שם משתמש</th>
                        <td mat-cell *matCellDef="let user">{{ user.firstName }} {{ user.lastName }}</td>
                    </ng-container>

                    <ng-container matColumnDef="email">
                        <th mat-header-cell *matHeaderCellDef>אימייל</th>
                        <td mat-cell *matCellDef="let user">{{ user.email }}</td>
                    </ng-container>

                    <ng-container matColumnDef="albumsCount">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>מספר אלבומים</th>
                        <td mat-cell *matCellDef="let user">{{ user.albumsCount }}</td>
                    </ng-container>

                    <ng-container matColumnDef="photosCount">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>מספר תמונות</th>
                        <td mat-cell *matCellDef="let user">{{ user.photosCount }}</td>
                    </ng-container>

                    <ng-container matColumnDef="storageUsed">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>נפח בשימוש</th>
                        <td mat-cell *matCellDef="let user">{{ formatFileSize(user.storageUsed) }}</td>
                    </ng-container>

                    <ng-container matColumnDef="lastActivity">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>פעילות אחרונה</th>
                        <td mat-cell *matCellDef="let user">{{ user.lastActivity | date:'dd/MM/yyyy' }}</td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="userActivityColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: userActivityColumns;"></tr>
                </table>
            </div>
        </mat-card-content>
    </mat-card>

    <!-- דוח אלבומים פופולריים -->
    <mat-card class="report-card">
        <mat-card-header>
            <mat-card-title>אלבומים פופולריים</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="popular-albums">
                <div *ngFor="let album of popularAlbums; let i = index" class="album-item">
                    <div class="album-rank">{{ i + 1 }}</div>
                    <div class="album-info">
                        <div class="album-name">{{ album.albumName }}</div>
                        <div class="album-owner">{{ album.ownerName }}</div>
                    </div>
                    <div class="album-stats">
                        <mat-chip-set>
                            <mat-chip color="primary">{{ album.photosCount }} תמונות</mat-chip>
                        </mat-chip-set>
                    </div>
                </div>
            </div>
        </mat-card-content>
    </mat-card>

    <!-- דוח תגיות פופולריות -->
    <mat-card class="report-card">
        <mat-card-header>
            <mat-card-title>תגיות פופולריות</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="tags-chart-container">
                <canvas baseChart 
                        [data]="tagsChartData" 
                        [options]="tagsChartOptions" 
                        [type]="'doughnut'">
                </canvas>
            </div>
        </mat-card-content>
    </mat-card>

    <!-- דוח רישומים חודשיים -->
    <mat-card class="report-card">
        <mat-card-header>
            <mat-card-title>מגמת רישומים חודשית</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="registrations-chart-container">
                <canvas baseChart 
                        [data]="registrationsChartData" 
                        [options]="registrationsChartOptions" 
                        [type]="'line'">
                </canvas>
            </div>
        </mat-card-content>
    </mat-card>

    <!-- דוח שימוש באחסון -->
    <mat-card class="report-card">
        <mat-card-header>
            <mat-card-title>דוח שימוש באחסון</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="storage-breakdown">
                <div class="storage-item">
                    <div class="storage-label">תמונות פעילות</div>
                    <div class="storage-bar">
                        <div class="storage-fill active" 
                             [style.width.%]="getStoragePercentage('active')"></div>
                    </div>
                    <div class="storage-value">{{ formatFileSize(storageBreakdown.activePhotos) }}</div>
                </div>

                <div class="storage-item">
                    <div class="storage-label">תמונות מחוקות</div>
                    <div class="storage-bar">
                        <div class="storage-fill deleted" 
                             [style.width.%]="getStoragePercentage('deleted')"></div>
                    </div>
                    <div class="storage-value">{{ formatFileSize(storageBreakdown.deletedPhotos) }}</div>
                </div>

                <div class="storage-item total">
                    <div class="storage-label">סה"כ</div>
                    <div class="storage-value total-value">{{ formatFileSize(storageBreakdown.total) }}</div>
                </div>
            </div>
        </mat-card-content>
    </mat-card>
</div>
